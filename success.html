<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmed - EchoGift</title>
    <meta name="description" content="Your personalized song order has been confirmed. We'll start creating your custom song gift right away!">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <section class="success-section">
        <div class="container">
            <div class="success-container">
                <div class="success-icon">
                    <div class="checkmark">‚úì</div>
                </div>
                
                <h1>Order Confirmed!</h1>
                <p class="success-subtitle">Thank you for your order. We're excited to create your personalized song gift!</p>
                
                <div class="order-confirmation">
                    <div class="confirmation-details">
                        <h3>Order Details</h3>
                        <div class="detail-row">
                            <span>Order Number:</span>
                            <span id="order-id">EG-1234567890</span>
                        </div>
                        <div class="detail-row">
                            <span>Product:</span>
                            <span id="product-name">Personalized Song</span>
                        </div>
                        <div class="detail-row">
                            <span>Total Paid:</span>
                            <span id="amount-paid">$81.30</span>
                        </div>
                        <div class="detail-row">
                            <span>Email:</span>
                            <span id="customer-email">customer@example.com</span>
                        </div>
                        <div class="detail-row">
                            <span>Estimated Delivery:</span>
                            <span id="delivery-date">Monday, January 15, 2024</span>
                        </div>
                    </div>
                </div>

                <div class="next-steps">
                    <h3>What Happens Next?</h3>
                    <div class="steps-grid">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>We Start Creating</h4>
                                <p>Our AI begins crafting your personalized song using the story and details you provided.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Quality Review</h4>
                                <p>Our team reviews the song to ensure it meets our high standards and captures your story perfectly.</p>
                            </div>
                        </div>
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Delivery</h4>
                                <p>You'll receive your custom song via email within 3-5 business days, ready to share and enjoy!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="contact-info">
                    <h3>Questions or Concerns?</h3>
                    <p>We're here to help! Contact us at <a href="mailto:support@echogift.com">support@echogift.com</a> or reference your order number <span id="order-reference">EG-1234567890</span> in any correspondence.</p>
                </div>

                <div class="success-actions">
                    <a href="index.html" class="primary-button">Create Another Song</a>
                    <a href="mailto:?subject=I just ordered a personalized song!&body=I just ordered a custom song from EchoGift! Check them out at echogift.com" class="secondary-button">Share with Friends</a>
                </div>

                <div class="social-share">
                    <p>Love what we're doing? Follow us for updates:</p>
                    <div class="social-links">
                        <a href="#" aria-label="Follow us on Facebook">üìò Facebook</a>
                        <a href="#" aria-label="Follow us on Instagram">üì∑ Instagram</a>
                        <a href="#" aria-label="Follow us on Twitter">üê¶ Twitter</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Stripe configuration
        const stripe = Stripe('pk_live_51RTWhNEinaZMSMtjUEnWpzUPDC8KZBlFOy9O4Is2iG6KDg0CrCLszCw8QksowdNQcUyFdp8BIuWmSPMYueau2t5200ayCjCLBw');
        
        // Load confirmation data and populate page
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            
            if (sessionId) {
                // Coming from Stripe Checkout
                retrieveStripeSession(sessionId);
            } else {
                // Try to load from sessionStorage (fallback)
                const confirmationData = JSON.parse(sessionStorage.getItem('confirmationData') || '{}');
                
                if (!confirmationData.orderId) {
                    // No confirmation data, redirect to home
                    window.location.href = 'index.html';
                    return;
                }

                populateOrderDetails(confirmationData);
            }
        });

        async function retrieveStripeSession(sessionId) {
            try {
                // Note: In production, you'd need a server endpoint to retrieve session details
                // For now, we'll create mock data based on sessionStorage order data
                const orderData = JSON.parse(sessionStorage.getItem('orderData') || '{}');
                
                const confirmationData = {
                    orderId: 'EG-' + sessionId.substring(-8),
                    amount: orderData.productType === 'single' ? 79.00 : 299.00,
                    product: orderData.productType === 'single' ? 'Personalized Song' : 'Custom Song Album',
                    email: orderData.email || 'customer@example.com',
                    estimatedDelivery: getEstimatedDelivery(),
                    sessionId: sessionId
                };
                
                populateOrderDetails(confirmationData);
                
                // Clear order data after successful payment
                sessionStorage.removeItem('orderData');
                
                // Show success message
                showSuccessMessage('Payment successful! Your order has been confirmed.');
                
            } catch (error) {
                console.error('Error retrieving session:', error);
                // Fallback to basic confirmation
                populateOrderDetails({
                    orderId: 'EG-' + Date.now(),
                    amount: 79.00,
                    product: 'Personalized Song',
                    email: 'customer@example.com',
                    estimatedDelivery: getEstimatedDelivery()
                });
            }
        }

        function populateOrderDetails(confirmationData) {
            document.getElementById('order-id').textContent = confirmationData.orderId;
            document.getElementById('order-reference').textContent = confirmationData.orderId;
            document.getElementById('product-name').textContent = confirmationData.product;
            document.getElementById('amount-paid').textContent = `$${confirmationData.amount.toFixed(2)}`;
            document.getElementById('customer-email').textContent = confirmationData.email;
            document.getElementById('delivery-date').textContent = confirmationData.estimatedDelivery;
        }

        function getEstimatedDelivery() {
            const deliveryDate = new Date();
            deliveryDate.setDate(deliveryDate.getDate() + 5); // 5 business days
            return deliveryDate.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function showSuccessMessage(message) {
            // Create success message element
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27AE60;
                color: white;
                padding: 16px 24px;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                font-weight: 500;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // Animate in
            setTimeout(() => {
                messageDiv.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 5 seconds
            setTimeout(() => {
                messageDiv.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 5000);
        }

        // Prevent back button after successful order
        history.pushState(null, null, location.href);
        window.onpopstate = function () {
            history.go(1);
        };
    </script>
</body>
</html>